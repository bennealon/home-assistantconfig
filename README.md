# home-assistantconfig

Home Assistant

## Fresh Install using this config

The recommended installation method is to use the hass.os image, this maintains full support for the addons and is the only supported way of running homeassistant.

If using a raspberry Pi, then Hass.os will be the operating system, doing it this way means you can forget about maintaing a linux OS underneath. If you want to install onto an existing linux install, its recommended to install as a docker container - but doing this will not install the add-on container support that you get by going with hass.os

Follow the guide here for your hardware: https://www.home-assistant.io/getting-started/

Now wait for the download to finish at: http://homeassistant.local:8123

Setup the admin user using the prompts.

Under supervisor, install the following addons:

Duck DNS
    - *note: perform the DuckDNS add-on first, the sambashare addon has been known to prevent the duck dns from writing the necessary files on first boot.*
    - Goto configuration, accept the terms, set the domain and token for the domain (obtained from duckdns login for the domain)
    - start the add-on

Samba Share
    - Goto configuration and set a secure password, this will be used for accessing the share.
    - start the add-on

Air Sonos
Air Cast
MariaDB
    - goto configuration and set the database password
    - start the add-on
InfluxDB
    - start the add-on
    - goto the influxdb admin console and user (with all permissions) that matches the credentials in secrets.yaml for homeassistant.
    - Create another user for grafana and assigna all permissions.
    - create a database for homeassistant.
    - restart homeassistant
Grafana
    - start the add-on
    - goto the grafana dashboard, and under configuration add a datasource for influxdb.

Once the share is active, we can access the configuration directory and checkout our code.

Navigate to the shared directory on the pi: http://<ip>/config

now checkout the code into this repository. since this config directory already contains files we will init the directory, add the remote, then checkout the branch (otherwise git complains about not empty directory)

```
git init

git remote add origin <url of this repository>

git fetch --all --prune

# checkout master, force so it overwrites any files in here that already exist
git checkout master -f

# perform a status and remove any files that are left over from the previous config.
git status

rm -rf <file name>

git commit -am 'my message'

git push origin master
```

Restart home assistant.


In the autogenerated file known_devices.yaml, find the iphones you want to track from the router, rename if necessary and enable tracking.

once the configuration is all loaded, go into configuration -> persons, and remove the non-yaml people (duplicates), you might need to rename the user entities that are now in the database to match the expected, eg person.ben_nealon

# TODO
add bedroom wakeup light.
google tts when tumble finished.
google home integration
